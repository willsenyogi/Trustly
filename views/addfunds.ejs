<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<% if (loggedUser && loggedUser.savingsTitle) { %>
    <p><%= loggedUser.savingsTitle %></p>
    <p>Total Savings Balance</p>
    <h2><%= new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(loggedUser.savingsAmount || 0) %></h2>
    <p>Savings Target : <%= new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(loggedUser.savingsTarget || 0) %></p>
<% } else { %>
    <p>Total Savings Balance</p>
    <h2><%= new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(0) %></h2>
<% } %>

<form action="/api/addfunds/savings" method="POST">
  <% if (loggedUser.savingsTitle && loggedUser.savingsTarget) { %>
    <input type="hidden" name="savingsTitle" placeholder="Savings Title" value="<%= loggedUser.savingsTitle %>" style="height: 40px; width: 300px; margin-bottom: 10px;"> <br>
    <input type="number" name="savingsAmount" placeholder="Deposit Amount" required style="height: 70px; font-size: larger;">
    <input type="submit" value="Deposit" style="height: 70px; font-size: larger; background-color: black; color: white; border: 2px solid white;">
  <% } else { %>    
    <input type="text" name="savingsTitle" placeholder="Savings Title" style="height: 40px; width: 300px; margin-bottom: 10px;"> <br>
    <input type="number" name="savingsTarget" placeholder="Savings Target" style="height: 40px; width: 300px; margin-bottom: 10px;"> <br>
    <input type="number" name="savingsAmount" placeholder="Deposit Amount" required style="height: 70px; font-size: larger;">
    <input type="submit" value="Deposit" style="height: 70px; font-size: larger; background-color: black; color: white; border: 2px solid white;">
  <% } %>
</form>

<% if (sdMessages && sdMessages.length > 0) { %>
  <div style="color: red;">
    <% sdMessages.forEach(function(msg) { %>
      <p><%= msg %></p>
    <% }); %>
  </div>
<% } %>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('success') === 'true') {
      Swal.fire({
        icon: 'success',
        title: 'Transfer Successful',
        text: 'Your transfer was completed successfully.',
        confirmButtonText: 'OK'
      }).then((result) => {
        if (result.isConfirmed) {
          // Redirect to the dashboard
          window.location.href = '/dashboard';
        }
      });
    }
  });
</script>
